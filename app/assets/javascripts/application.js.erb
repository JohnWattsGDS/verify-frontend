// from govuk_frontend_toolkit
//= require vendor/polyfills/bind

// from govuk_elements
//= require details.polyfill

//= require jquery
//= require jquery_ujs
//= require govuk/shim-links-with-button-role
//= require_tree .
//= require piwik

window.GOVUK.shimLinksWithButtonRole.init();

window.GOVUK.validation.init();
window.GOVUK.selectDocuments.init();
//window.GOVUK.selectPhone.init();
//window.GOVUK.selectPhoneb.init();
window.GOVUK.willItWorkForMe.init();
window.GOVUK.feedback.init();
window.GOVUK.furtherInformation.init();
window.GOVUK.interstitialQuestion.init();
window.GOVUK.otherDocuments.init();

abTest({
  experiment: 'app_transparency',
  routeA: window.GOVUK.selectPhone,
  routeB: window.GOVUK.selectPhoneb
})


$(function () {
  window.GOVUK.validation.attach();
  window.GOVUK.signin.attach();
  window.GOVUK.autoSubmitForm.attach();
  window.GOVUK.chooseACountry.attach();


  // Ensure that the fingerprint epoch is increased whenever the algorithm is changed
  // in any way - this will ensure that we compare like with like
  var fingerprintEpoch = 5;
  reportFingerprint('<%= FINGERPRINT_CONFIG %>', fingerprintEpoch, document.getElementById('fp_img'));
});

function abTest(experimentDetails) {
  const routeB = experimentDetails.experiment.concat('_variant')

  if (document.cookie.indexOf("ab_test") >= 0) {
    const abCookie = JSON.parse(getCookie("ab_test"))

    if (abCookie.app_transparency === routeB) {
      experimentDetails.routeB.init();
    } else {
      experimentDetails.routeA.init();
    }
  } else {
    experimentDetails.routeA.init();
  }
}

function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(';');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}



