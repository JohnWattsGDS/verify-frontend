<% content_for :html_lang, params[:locale] %>
<% content_for :page_title, ' - GOV.UK Verify - GOV.UK' %>

<% content_for :head do %>
  <!--[if gt IE 8]><!--><%= stylesheet_link_tag 'style' %><!--<![endif]-->
  <!--[if IE 8]><%= stylesheet_link_tag 'style-ie8' %><![endif]-->
  <%= csrf_meta_tags %>
<% end %>

<% content_for :content do %>
  <main id="content">
    <%= render 'shared/phase_banner' %>
    <div class="grid-row">
      <%= render 'shared/available_languages' %>
    </div>
    <%= content_for?(:main) ? yield(:main) : yield %>
  </main>
  <%= render 'shared/piwik' %>
<% end %>

<% content_for :footer_support_links do %>
  <h2 class="visuallyhidden">Support links</h2>
  <ul>
    <li><a href="https://gov.uk/help">Help</a></li>
    <li><%= link_to(t('hub.cookies.title'), cookies_path) %></li>
    <li><%= link_to(t('hub.privacy_notice.title'), privacy_notice_path) %></li>
    <li>
    <% if feedback_source.present? %>
        <%= link_to(t('hub.feedback.title'), feedback_path('feedback-source' => feedback_source)).html_safe %>
    <% else %>
        <%= link_to(t('hub.feedback.title'), feedback_path) %>
    <% end %>
    </li>
    <li>Built by the <a href="https://gds.blog.gov.uk">Government Digital Service</a></li>
  </ul>
<% end %>

<% content_for :body_end do %>

  <%= javascript_include_tag 'application' %>

  <%# Browser Fingerprinting Code Begins %>
  <%# ensure that the epoch is increased whenever the fingerprint algorithm is changed in any way - this will ensure that we compare like with like %>
  <%= image_tag('', style: 'border: 0', height: '1', width: '1', id: 'fp_img') %>
  <%= javascript_tag do %>
    var fingerprintEpoch = '4';
    // disabling javascript font parsing, this is very slow, and the canvas because it yields a different fingerprint for the first page loaded
    var options = {excludeJsFonts: true, excludeCanvas: true};
    var componentsToExclude = ['webgl'];
    // based on jQuery's param implementation https://github.com/jquery/jquery/blob/master/src/serialize.js
    var serialiseComponents = function(components) {
      r = [];
      jQuery.each(components, function() {
        if(componentsToExclude.indexOf(this.key) == -1) {
          r[r.length] = encodeURIComponent(this.key) + "=" + encodeURIComponent(this.value);
        }
      });
      return r.join("&");
    };
    new Fingerprint2(options).get(function(result, components){
      document.getElementById('fp_img').src = '/assets2/fp.gif?hash='+fingerprintEpoch+'-'+result+'&cache_bust='+(new Date().getTime())+'&components='+serialiseComponents(components);
    });
  <% end %>

  <noscript style="positior: absolute;">
    <%= image_tag('/assets2/fp.gif?hash=noJS', style: 'border: 0', height: '1', width: '1', id: 'fp_img_no_js') %>
  </noscript>

  <%# Browser Fingerprinting Code Ends %>

<% end %>
<%= render file: 'layouts/govuk_template' %>
